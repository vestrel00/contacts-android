
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Android Contacts API Library for Kotlin and Java.">
      
      
        <meta name="author" content="Vandolf Estrellado">
      
      
        <link rel="canonical" href="https://vestrel00.github.io/contacts-android/dev-notes/">
      
      
        <link rel="prev" href="../contributing/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.41">
    
    
      
        <title>Developer notes - Contacts, Reborn</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developer-notes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Contacts, Reborn" class="md-header__button md-logo" aria-label="Contacts, Reborn" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 0H4v2h16zM4 24h16v-2H4zM20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2m-8 2.75A2.25 2.25 0 0 1 14.25 9 2.25 2.25 0 0 1 12 11.25 2.25 2.25 0 0 1 9.75 9 2.25 2.25 0 0 1 12 6.75M17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Contacts, Reborn
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developer notes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vestrel00/contacts-android" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    vestrel00/contacts-android
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Contacts, Reborn" class="md-nav__button md-logo" aria-label="Contacts, Reborn" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 0H4v2h16zM4 24h16v-2H4zM20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2m-8 2.75A2.25 2.25 0 0 1 14.25 9 2.25 2.25 0 0 1 12 11.25 2.25 2.25 0 0 1 9.75 9 2.25 2.25 0 0 1 12 6.75M17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5z"/></svg>

    </a>
    Contacts, Reborn
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vestrel00/contacts-android" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    vestrel00/contacts-android
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cheatsheet
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/setup-contacts-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contacts API Setup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Entities
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Entities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/about-api-entities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API entities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/about-blank-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blank contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/about-blank-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blank data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/about-local-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local (device-only) contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/about-contact-lookup-key/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact lookup key vs ID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/sync-contact-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sync contact data across devices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entities/redact-apis-and-entities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redact entities and API input and output in production
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/query-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/query-contacts-advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query contacts (advanced)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/query-contacts-by-phone-or-sip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query contacts by phone or SIP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/query-raw-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query RawContacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/insert-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/update-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/delete-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/include-only-desired-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Include only certain fields for read and write operations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basics/limit-and-offset-queries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using limit and offset in queries
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/query-data-sets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query specific data kinds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/insert-data-sets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert data into new or existing contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/update-data-sets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update existing sets of data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/delete-data-sets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete existing sets of data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Custom data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Custom data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/query-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/insert-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert custom data into new or existing contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/update-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/delete-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-custom-data-from-other-apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate custom data from other apps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-googlecontacts-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate the Google Contacts custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-gender-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate the Gender custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-handlename-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate the Handle Name custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-pokemon-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate the Pokemon custom data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customdata/integrate-rpg-custom-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate the RPG custom data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Groups
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Groups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../groups/query-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../groups/insert-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../groups/update-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../groups/delete-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete groups
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Profile
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Profile
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile/query-profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query device owner Contact profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile/insert-profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert device owner Contact profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile/update-profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update device owner Contact profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profile/delete-profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete device owner Contact profile
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Accounts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Accounts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accounts/query-accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query for Accounts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accounts/move-raw-contacts-across-accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Move RawContacts across Accounts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SIM card
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            SIM card
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/about-sim-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About SIM contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/query-sim-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query contacts in SIM card
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/insert-sim-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert contacts into SIM card
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/update-sim-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update contacts in SIM card
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sim/delete-sim-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete contacts from SIM card
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blocked numbers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Blocked numbers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockednumbers/about-blocked-numbers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About blocked numbers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockednumbers/query-blocked-numbers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query blocked numbers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockednumbers/insert-blocked-numbers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert blocked numbers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockednumbers/delete-blocked-numbers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delete blocked numbers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Permissions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Permissions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../permissions/permissions-handling-coroutines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Permissions handling using coroutines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Asynchronous work
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Asynchronous work
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../async/async-execution-coroutines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execute work outside of the UI thread using coroutines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            UI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ui/integrate-rudimentary-contacts-integrated-ui-components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate rudimentary contacts ui components
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Other
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/get-set-remove-contact-raw-contact-photo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get set remove full-sized and thumbnail contact photos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/get-set-clear-contact-raw-contact-options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get set contact options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/get-set-clear-default-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get set clear default Contact data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/link-unlink-contacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Link unlink Contacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/share-contacts-vcard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Share Contacts vCard (.VCF)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../other/convenience-functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Convenience functions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Logging
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Logging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/log-api-input-output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log API input and output
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/test-contacts-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contacts API Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            Debug
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/debug-contacts-provider-tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug the Contacts Provider tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/debug-blockednumber-provider-tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug the BlockedNumber Provider tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debug/debug-sim-contacts-tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debug the Sim Contacts table
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Developer notes
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Developer notes
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#contacts-provider-contactscontract" class="md-nav__link">
    <span class="md-ellipsis">
      Contacts Provider / ContactsContract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contacts Provider / ContactsContract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contacts-display-name" class="md-nav__link">
    <span class="md-ellipsis">
      Contacts; Display Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contact-display-name-and-default-name-rows" class="md-nav__link">
    <span class="md-ellipsis">
      Contact Display Name and Default Name Rows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contacts-id-vs-lookup_key" class="md-nav__link">
    <span class="md-ellipsis">
      Contacts; ID vs LOOKUP_KEY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rawcontacts-accounts-contacts" class="md-nav__link">
    <span class="md-ellipsis">
      RawContacts; Accounts + Contacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rawcontacts-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      RawContacts; Deletion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-rawcontacts-per-contact" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple RawContacts Per Contact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#behavior-of-linkingmergingjoining-contacts-aggregationexceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior of linking/merging/joining contacts (AggregationExceptions)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregationexceptions-table" class="md-nav__link">
    <span class="md-ellipsis">
      AggregationExceptions table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-table" class="md-nav__link">
    <span class="md-ellipsis">
      Data Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-primary-and-super-primary-rows" class="md-nav__link">
    <span class="md-ellipsis">
      Data Primary and Super Primary Rows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-table-joins" class="md-nav__link">
    <span class="md-ellipsis">
      Data Table Joins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Data Updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-required" class="md-nav__link">
    <span class="md-ellipsis">
      Data Required
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structuredname" class="md-nav__link">
    <span class="md-ellipsis">
      Data StructuredName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structuredpostal" class="md-nav__link">
    <span class="md-ellipsis">
      Data StructuredPostal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-table-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Groups Table &amp; Accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-table-groupmemberships-data-table" class="md-nav__link">
    <span class="md-ellipsis">
      Groups Table &amp; GroupMemberships (Data Table)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starred-in-android-favorites" class="md-nav__link">
    <span class="md-ellipsis">
      Starred in Android (Favorites)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-memberships-local-rawcontacts" class="md-nav__link">
    <span class="md-ellipsis">
      Group memberships &amp; Local RawContacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Groups; Deletion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Groups; UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-profile" class="md-nav__link">
    <span class="md-ellipsis">
      User Profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncing-data-sync-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      Syncing Data / Sync Adapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-data-mimetypes" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Data / MimeTypes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unused-contactscontract-stuff" class="md-nav__link">
    <span class="md-ellipsis">
      Unused ContactsContract Stuff
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java-support" class="md-nav__link">
    <span class="md-ellipsis">
      Java Support
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-entities-data-class" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Entities &amp; data class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#immutable-vs-mutable-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Immutable vs Mutable Entities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Immutable vs Mutable Entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-cost-of-the-current-immutability-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      The cost of the current immutability implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoiding-the-cost-shortcuts-and-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Avoiding the cost... Shortcuts and pitfalls.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-not-add-android-x-support-library-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Why Not Add Android X / Support Library Dependencies?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#contacts-provider-contactscontract" class="md-nav__link">
    <span class="md-ellipsis">
      Contacts Provider / ContactsContract
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contacts Provider / ContactsContract">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contacts-display-name" class="md-nav__link">
    <span class="md-ellipsis">
      Contacts; Display Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contact-display-name-and-default-name-rows" class="md-nav__link">
    <span class="md-ellipsis">
      Contact Display Name and Default Name Rows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contacts-id-vs-lookup_key" class="md-nav__link">
    <span class="md-ellipsis">
      Contacts; ID vs LOOKUP_KEY
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rawcontacts-accounts-contacts" class="md-nav__link">
    <span class="md-ellipsis">
      RawContacts; Accounts + Contacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rawcontacts-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      RawContacts; Deletion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-rawcontacts-per-contact" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple RawContacts Per Contact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#behavior-of-linkingmergingjoining-contacts-aggregationexceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Behavior of linking/merging/joining contacts (AggregationExceptions)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregationexceptions-table" class="md-nav__link">
    <span class="md-ellipsis">
      AggregationExceptions table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-table" class="md-nav__link">
    <span class="md-ellipsis">
      Data Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-primary-and-super-primary-rows" class="md-nav__link">
    <span class="md-ellipsis">
      Data Primary and Super Primary Rows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-table-joins" class="md-nav__link">
    <span class="md-ellipsis">
      Data Table Joins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Data Updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-required" class="md-nav__link">
    <span class="md-ellipsis">
      Data Required
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structuredname" class="md-nav__link">
    <span class="md-ellipsis">
      Data StructuredName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structuredpostal" class="md-nav__link">
    <span class="md-ellipsis">
      Data StructuredPostal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-table-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Groups Table &amp; Accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-table-groupmemberships-data-table" class="md-nav__link">
    <span class="md-ellipsis">
      Groups Table &amp; GroupMemberships (Data Table)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starred-in-android-favorites" class="md-nav__link">
    <span class="md-ellipsis">
      Starred in Android (Favorites)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-memberships-local-rawcontacts" class="md-nav__link">
    <span class="md-ellipsis">
      Group memberships &amp; Local RawContacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Groups; Deletion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#groups-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Groups; UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-profile" class="md-nav__link">
    <span class="md-ellipsis">
      User Profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#syncing-data-sync-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      Syncing Data / Sync Adapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-data-mimetypes" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Data / MimeTypes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unused-contactscontract-stuff" class="md-nav__link">
    <span class="md-ellipsis">
      Unused ContactsContract Stuff
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java-support" class="md-nav__link">
    <span class="md-ellipsis">
      Java Support
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-entities-data-class" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Entities &amp; data class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#immutable-vs-mutable-entities" class="md-nav__link">
    <span class="md-ellipsis">
      Immutable vs Mutable Entities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Immutable vs Mutable Entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-cost-of-the-current-immutability-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      The cost of the current immutability implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoiding-the-cost-shortcuts-and-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Avoiding the cost... Shortcuts and pitfalls.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-not-add-android-x-support-library-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Why Not Add Android X / Support Library Dependencies?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="developer-notes">Developer Notes<a class="headerlink" href="#developer-notes" title="Permanent link">&para;</a></h1>
<p>This document contains useful developer notes that should be kept in mind during development. It 
serves as a memory of all the quirks and gotcha's of things like Android's <code>ContactsContract</code>.</p>
<p>This is only meant to be read by contributors of this library, not consumers!</p>
<h2 id="contacts-provider-contactscontract">Contacts Provider / ContactsContract<a class="headerlink" href="#contacts-provider-contactscontract" title="Permanent link">&para;</a></h2>
<p>It is important to know about the ins and outs of Android's Contacts Provider. After all, this API 
is just a wrapper around it. </p>
<p>It is important to get familiar with the <a href="https://developer.android.com/guide/topics/providers/contacts-provider">official documentation of the Contact's Provider</a>.</p>
<p>Here is a summary;</p>
<p>There are 3 main database tables used in dealing with contacts;</p>
<ol>
<li>Contacts</li>
<li>RawContacts</li>
<li>Data</li>
</ol>
<blockquote>
<p>ℹ️ There are more but that is covered later.</p>
</blockquote>
<p>All of these tables and their fields are enumerated and documented in
<code>android.provider.ContactsContract</code>. </p>
<p>Each table serves a different purpose;</p>
<ol>
<li>Contacts<ul>
<li>Rows representing different people.</li>
</ul>
</li>
<li>RawContacts<ul>
<li>Rows that link Contacts rows to specific Accounts.</li>
</ul>
</li>
<li>Data<ul>
<li>Rows containing data (e.g. name, email) for a RawContacts row.</li>
</ul>
</li>
</ol>
<p>These tables contain the following (notable) information (columns);</p>
<ol>
<li><code>Contacts</code><ul>
<li><code>_ID</code></li>
<li><code>DISPLAY_NAME_PRIMARY</code></li>
</ul>
</li>
<li><code>RawContacts</code><ul>
<li><code>_ID</code>: the <code>Contacts._ID</code></li>
<li><code>ACCOUNT_NAME</code>: the <code>Account.name</code></li>
<li><code>ACCOUNT_TYPE</code> the <code>Account.type</code></li>
</ul>
</li>
<li><code>Data</code><ul>
<li><code>RAW_CONTACT_ID</code>: the <code>RawContacts._ID</code></li>
<li><code>CONTACT_ID</code>: the <code>Contacts._ID</code></li>
<li><code>DATA_1</code> to <code>DATA_15</code>: contains a piece of contact data 
  (e.g. first and last name, email address and type) determined by 
  the <code>MIMETYPE</code></li>
<li><code>MIMETYPE</code>: the type of data that this row's <code>DATA_X</code> columns contain
  (e.g. name and email data)</li>
</ul>
</li>
</ol>
<p>The tables are connected the following way;</p>
<ul>
<li>RawContacts contains a reference to the Contacts row Id.</li>
<li>Data contains a reference to the RawContacts row Id and Contacts row Id. </li>
</ul>
<h3 id="contacts-display-name">Contacts; Display Name<a class="headerlink" href="#contacts-display-name" title="Permanent link">&para;</a></h3>
<p>The <code>Contacts.DISPLAY_NAME</code> name may be different than the Data <code>StructuredName</code> display name! If a
structured name in the Data table is not provided, then other kinds of data will be used as the 
<code>Contacts</code> row display name. For example, if an email is provided but no structured name then the
display name will be the email. When a structured name is inserted, the Contacts Provider 
automatically updates the Contacts row display name.</p>
<blockquote>
<p>ℹ️ In the case of <code>StructuredName</code>, the <code>Contacts.DISPLAY_NAME</code> is made up of the prefix, given,
middle, family name, and suffix and not the unstructured display name.</p>
</blockquote>
<p>If no data rows suitable to be a display name are available, then the Contacts row display name will
be null. Data suitable to be a Contacts row display name are enumerated in <code>DisplayNameSources</code>;</p>
<ul>
<li>email</li>
<li>nickname</li>
<li>organization</li>
<li>phone number</li>
<li>structured name</li>
</ul>
<p>Data not suitable to be display names are;</p>
<ul>
<li>address</li>
<li>event</li>
<li>group</li>
<li>im</li>
<li>note</li>
<li>relation</li>
<li>sip</li>
<li>website</li>
</ul>
<p>The kind of data used as the display for the Contact is set in
<code>ContactNameColumns.DISPLAY_NAME_SOURCE</code>.</p>
<p><strong>A note about <code>StructuredName</code></strong></p>
<p>There may be a scenario where the unstructured <code>StructuredName.DISPLAY_NAME</code> does not match the
structured components. Such scenarios are possible but is considered incorrect. For example,
it is possible to programmatically set the display name to "Ice Cold" but set the given and family
name to "Hot Fire". The <code>Contacts.DISPLAY_NAME</code> is made up of the prefix, given, middle, family
name, and suffix ("Hot Fire") and not the unstructured display name.</p>
<p>The Contacts Provider's <a href="https://developer.android.com/training/contacts-provider/retrieve-names#GeneralMatch">general matching</a> algorithm does <strong>not</strong> include the
<code>Contacts.DISPLAY_NAME</code>. However, the <code>StructuredName.DISPLAY_NAME</code> is included in the matching
process but not the rest of the structured components (e.g. given and family name).</p>
<p>The AOSP Contacts app displays the <code>Contacts.DISPLAY_NAME</code>. So, here comes the unusual scenario
that looks like a bug. The <a href="https://developer.android.com/training/contacts-provider/retrieve-names#GeneralMatch">general matching</a> algorithm will match the text "Ice" or "Cold" but
not "Hot" or "Fire". The end result is that searching for the Contact "Ice Cold" will show a
Contact called "Hot Fire"!</p>
<h3 id="contact-display-name-and-default-name-rows">Contact Display Name and Default Name Rows<a class="headerlink" href="#contact-display-name-and-default-name-rows" title="Permanent link">&para;</a></h3>
<p>If available, the "default" (isPrimary and isSuperPrimary set to 1) name row for a Contact is 
automatically set as the Contact display name by the Contacts Provider. Otherwise, the Contacts
Provider chooses from any of the other suitable data from the aggregate Contact.</p>
<blockquote>
<p>ℹ️ The <code>ContactsColumns.NAME_RAW_CONTACT_ID</code> is automatically updated by the Contacts Provider
along with the display name.</p>
</blockquote>
<p>The default status of other sources (e.g. email) does not affect the Contact display name.</p>
<p>The AOSP Contacts app also sets the most recently updated name as the default at every update. 
This results in the Contact display name changing to the most recently updated name from one of the
associated RawContacts. The "most recently updated name" is the name field that was last updated
by the user when editing in the Contacts app, which is irrelevant to its value. It does not matter
if the user deleted the last character of the name, added the same character back, and then saved. 
It still counts as the most recently updated. </p>
<p>All of the above only applies to API 21 and above.</p>
<p><strong>Display name resolution is different for APIs below 21 (pre-Lollipop)!</strong></p>
<p>The <code>ContactsColumns.NAME_RAW_CONTACT_ID</code> was added in API 21. It changed the way display names
are resolved for Contacts with more than one constituent RawContacts, which is what has been 
described so far.</p>
<p>Before this change (APIs 20 and below), the AOSP Contacts app is still able to set the Contact
display name somehow. I'm not sure how. If someone figures it out, please let me know. I tried 
updating the Contact <code>DISPLAY_NAME</code> directly but it does not work. Setting a name row as default 
also does not affect the Contact <code>DISPLAY_NAME</code>.</p>
<h3 id="contacts-id-vs-lookup_key">Contacts; ID vs LOOKUP_KEY<a class="headerlink" href="#contacts-id-vs-lookup_key" title="Permanent link">&para;</a></h3>
<p>The <code>Contacts._ID</code> is the unique identifier for the row in the Contacts table. The
<code>Contacts.LOOKUP_KEY</code> is the unique identifier for an aggregate Contact (a person). The <code>_ID</code> may
change due to aggregation and sync. The same goes for the <code>LOOKUP_KEY</code> but unlike the <code>ID</code> it may
still be used to find the aggregate contact.</p>
<p>Unlike the Contact ID, the lookup key is the same across devices (for contacts that are associated
with an Account and are synced).</p>
<blockquote>
<p>ℹ️ I did the following investigation with a much larger data set. I simplified it here for brevity.</p>
</blockquote>
<p>Let's take a look at the following Contacts and RawContacts table rows,</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>#### Contacts table
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Contact id: 55, lookupKey: 0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50, displayNamePrimary: Contact With Local RawContact
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Contact id: 56, lookupKey: 2059i6f5de8460f7f227e, displayNamePrimary: Contact With Synced RawContact
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>#### RawContacts table
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>RawContact id: 55, contactId: 55, sourceId: null, displayNamePrimary: Contact With Local RawContact
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>RawContact id: 56, contactId: 56, sourceId: 6f5de8460f7f227e, displayNamePrimary: Contact With Synced RawContact
</span></code></pre></div>
<p>There are two Contacts each having one RawContact.</p>
<p>Notice that the lookup keys are a bit different.</p>
<ul>
<li>Contact With Local RawContact: 0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50</li>
<li>Contact With Synced RawContact: 2059i6f5de8460f7f227e</li>
</ul>
<p>The Contact with synced RawContact uses the RawContact's <code>SOURCE_ID</code> as part of its lookup key.</p>
<p>The Contact with unsynced, device-only, local RawContact has a much longer (or shorter e.g. 0r62-2A2C2E)
lookup key and starts with "0r<RawContact ID>-" and all characters after it are in uppercase. The 
other thing to notice is that the "55" in "0r55-" seems to be the same as the RawContact ID (I did 
a bit more experiments than what is written in these notes to confirm that it is indeed the 
RawContact ID and not the Contact ID). We probably don't need to worry about these details though 
the Contacts Provider probably uses these things internally. We also should not rely on it. </p>
<p>However, it may be safe to assume that the <strong>Contact lookup key is a reference to a RawContact</strong> 
(or reference to more than one constituent RawContact when multiple RawContacts are linked). Again,
an internal Contacts Provider detail we should not rely on BUT is probably relevant when implementing
sync adapters.</p>
<p><strong>When we link</strong> the two, we get...</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Contact id: 55, lookupKey: 0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50.2059i6f5de8460f7f227e, displayNamePrimary: Contact With Synced RawContact
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>#### RawContacts table
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>RawContact id: 55, contactId: 55, sorceId: null, displayNamePrimary: Contact With Local RawContact
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>RawContact id: 56, contactId: 55, sourceId: 6f5de8460f7f227e, displayNamePrimary: Contact With Synced RawContact
</span></code></pre></div>
<p>Notice,</p>
<ul>
<li>Contact with ID 56 has been deleted.</li>
<li>Contact with ID 55 still exist with the <strong>lookup keys of both Contact 55 and 56 combined separated by a "."</strong>. <ul>
<li>This holds true in cases where two or more local-only or non-local-only RawContacts are linked.</li>
</ul>
</li>
<li>RawContacts remain unchanged except reference to Contact 56 has been replaced with 55.</li>
<li>The primary display name of Contact 55 came from RawContact 55 prior to the link and now comes
  from RawContact 56 after the link.</li>
<li>This primary name resolution is probably irrelevant so pay no attention to it.</li>
</ul>
<p>The most important part to notice is that the lookup keys get combined.</p>
<p>The lookup uri is required to build a <code>Contacts.CONTENT_LOOKUP_URI</code>...</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="cm">/**</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="cm"> * A content:// style URI for this table that should be used to create</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="cm"> * shortcuts or otherwise create long-term links to contacts. This URI</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="cm"> * should always be followed by a &quot;/&quot; and the contact&#39;s {@link #LOOKUP_KEY}.</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="cm"> * It can optionally also have a &quot;/&quot; and last known contact ID appended after</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="cm"> * that. This &quot;complete&quot; format is an important optimization and is highly recommended.</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="cm"> * &lt;p&gt;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="cm"> * As long as the contact&#39;s row ID remains the same, this URI is</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="cm"> * equivalent to {@link #CONTENT_URI}. If the contact&#39;s row ID changes</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="cm"> * as a result of a sync or aggregation, this URI will look up the</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="cm"> * contact using indirect information (sync IDs or constituent raw</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="cm"> * contacts).</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="cm"> * &lt;p&gt;</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="cm"> * Lookup key should be appended unencoded - it is stored in the encoded</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="cm"> * form, ready for use in a URI.</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="cm"> */</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="n">CONTENT_LOOKUP_URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Uri</span><span class="p">.</span><span class="na">withAppendedPath</span><span class="p">(</span><span class="n">CONTENT_URI</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lookup&quot;</span><span class="p">);</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="cm">/**</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="cm"> * Build a {@link #CONTENT_LOOKUP_URI} lookup {@link Uri} using the</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="cm"> * given {@link ContactsContract.Contacts#_ID} and {@link #LOOKUP_KEY}.</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="cm"> * &lt;p&gt;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="cm"> * Returns null if unable to construct a valid lookup URI from the</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="cm"> * provided parameters.</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="cm"> */</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="nf">getLookupUri</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">contactId</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lookupKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TextUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">lookupKey</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ContentUris</span><span class="p">.</span><span class="na">withAppendedId</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="na">withAppendedPath</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="na">CONTENT_LOOKUP_URI</span><span class="p">,</span><span class="w"> </span><span class="n">lookupKey</span><span class="p">),</span><span class="w"> </span><span class="n">contactId</span><span class="p">);</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="p">}</span>
</span></code></pre></div>
<p>From the lookup uri, we can lookup the Contact row...</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="nf">lookupContact</span><span class="p">(</span><span class="n">ContentResolver</span><span class="w"> </span><span class="n">resolver</span><span class="p">,</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="n">lookupUri</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Or simply get the Contact ID...</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// code inside `public static Uri lookupContact`</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">resolver</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">lookupUri</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="n">Contacts</span><span class="p">.</span><span class="na">_ID</span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
</span></code></pre></div>
<p>However, given that the lookup key of the deleted Contact 56 still lives on, it is possible to get 
the linked Contact 55 using the lookup key of Contact 56 using our standard query APIs!</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">.</span><span class="na">where</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Contact</span><span class="p">.</span><span class="na">LookupKey</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">lookupKey</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>The above is correct as long as these assumptions hold true;</p>
<ul>
<li>the lookup key is unique </li>
<li>there is no lookup key that can contain a shorter lookup key<ul>
<li>the Contact ID fails this test because a smaller number is contained in a larger number</li>
<li>synced contacts have shorter lookup keys than local contacts. However, local contacts' 
  lookup keys are capitalized whereas synced contact are not. Also, there seems to be other
  differences in pattern between long and short lookup keys. It should be safe to make this
  assumption.</li>
</ul>
</li>
</ul>
<p>Until the community finds that this assumption is flawed, we'll assume that it is true! For now, we
can <strong>avoid having to create another API or extensions just for using lookup keys</strong>. </p>
<p><strong>When we unlink</strong>, we get...</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>#### Contacts table
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Contact id: 55, lookupKey: 2059i6f5de8460f7f227e, displayNamePrimary: Contact With Synced RawContact
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Contact id: 58, lookupKey: 0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50, displayNamePrimary: Contact With Local RawContact
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>#### RawContacts table
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>RawContact id: 55, contactId: 58, sourceId: null, displayNamePrimary: Contact With Local RawContact
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>RawContact id: 56, contactId: 55, sourceId: 6f5de8460f7f227e, displayNamePrimary: Contact With Synced RawContact
</span></code></pre></div>
<p>Notice,</p>
<ul>
<li>A new Contact row with ID of 58 is created.</li>
<li>The lookup keys are separated and distributed between Contact 55 and 58.</li>
<li>RawContact 55 Contact reference has been set to Contact 58.</li>
</ul>
<p>Let's compare the Contact-RawContact relationship before and after linking and then unlinking.</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>Contact ID</strong></th>
<th><strong>Lookup Key</strong></th>
<th><strong>RawContact.Contact ID</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Before</strong></td>
<td>55,<br>56</td>
<td>0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50,<br>2059i6f5de8460f7f227e</td>
<td>55,<br>56</td>
</tr>
<tr>
<td><strong>After</strong></td>
<td>55,<br>58</td>
<td>2059i6f5de8460f7f227e,<br>0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50</td>
<td>58,<br>55</td>
</tr>
</tbody>
</table>
<p>Notice,</p>
<ul>
<li>Contact ID 55 swapped lookup keys with the former Contact 56 (now 58).</li>
<li>RawContact ID 55 swapped Contact reference with RawContact 56.</li>
</ul>
<p>The Contact IDs and lookup keys got shuffled BUT the Contact-RawContact relationship remains the 
same if using the lookup keys as point of reference! Here is another way to look at the table,
using the lookup key as the constant...</p>
<table>
<thead>
<tr>
<th><strong>Lookup Key</strong></th>
<th><strong>Before</strong></th>
<th><strong>After</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>0r55-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50</td>
<td>Contact 55,<br>RawContact 55</td>
<td>Contact 58,<br>RawContact 55</td>
</tr>
<tr>
<td>2059i6f5de8460f7f227e</td>
<td>Contact 56,<br>RawContact 56</td>
<td>Contact 55,<br>RawContact 56</td>
</tr>
</tbody>
</table>
<p>Notice that the indirect relationship between the lookup key and RawContacts remains the same 
before and after the link-unlink even though the Contact IDs changed.</p>
<blockquote>
<p>ℹ️ As mentioned earlier in this section, the "55" in "0r55-" seems to be referencing the 
RawContact ID. In other words, since local RawContacts are not synced or tracked in a remote 
database where Contacts -&gt; RawContacts mappings exist, the Contacts Provider most likely uses this 
"0r<RawContact ID>-" pattern to make the connection. This is not really relevant for us as we are
not relying on this mechanism. I'm just pointing out my observations, which could be incorrect.</p>
</blockquote>
<p>This means that...</p>
<ul>
<li>If users of this library saved a reference Contact ID 55, then a link-unlink (or sync adapter 
  functions) occur. <ul>
<li>Getting Contact by ID 55 will result in the RawContact-Data of the former Contact 56 to be 
  returned. This is a bug! Same goes if users saved a reference to Contact ID 56.</li>
</ul>
</li>
<li>If users of this library saved a reference to the lookup keys, then a link-unlink (or sync adapter
  functions) occur.<ul>
<li>Getting Contact by lookup key will result in the correct RawContact-Data to be returned.</li>
</ul>
</li>
</ul>
<p>So when to use Contact ID vs lookup key?</p>
<ul>
<li>Lookup key: for a reference to a Contact that needs to be loaded after some period of time.<ul>
<li>Saving/restoring activity/fragment instance state.</li>
<li>Saving to an external database, preferences, or files.</li>
<li>Creating shortcuts.</li>
</ul>
</li>
<li>ID: for everything else.<ul>
<li>Performing read/write operations in the same function call or session in your app.</li>
<li>Performing read/write operations that require ID (e.g. Contact photo and options).</li>
</ul>
</li>
</ul>
<p>Another thing to check is what happens when associating a local RawContact to an Account (move from
device to Account) and vice versa. Is the lookup key of the Contact affected?</p>
<p>After associating the local RawContact to an Account...</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>#### Contacts table
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>Contact id: 58, lookupKey: 2059i4abd4a8f8ff89642
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>#### RawContacts table
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>RawContact id: 55, contactId: 58, sourceId: 2059i4abd4a8f8ff89642
</span></code></pre></div>
<p>The lookup key changed (since the RawContact's source ID has been assigned the value that came from
the sync adapter) but the Contact ID remained the same! In this case, loading a reference to
the previously local Contact will fail! I verified that this is indeed the behavior of the AOSP
(AOSP) Contacts app. Moving the RawContact from device to Google using Google Contacts app while 
having Contact details activity opened in the AOSP Contacts app will result in "error Contact does
not exist" message in the AOSP Contacts app!</p>
<blockquote>
<p>ℹ️ The RawContact and its Data also remained the same in this case.</p>
</blockquote>
<p>Removing the account from it results in...</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>#### Contacts table
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Contact id: 59, lookupKey: 0r58-2E4644502A2E50563A503840462E2A404C2A562E4644502A2E50
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>#### RawContacts table
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>RawContact id: 58, contactId: 59, sourceId: null
</span></code></pre></div>
<p>The Contact and RawContacts row have been deleted and new rows have been created to replace them!
I also verified that the Data rows have also been deleted and new rows have been created to 
replace them!</p>
<p>This stuff is not really relevant for lookup key but still good to know for implementing
moving between accounts in the future.</p>
<h3 id="rawcontacts-accounts-contacts">RawContacts; Accounts + Contacts<a class="headerlink" href="#rawcontacts-accounts-contacts" title="Permanent link">&para;</a></h3>
<p>The RawContacts table associates a person to an <code>android.accounts.Account</code> that it belongs to. </p>
<p>Each new RawContacts row created results in;</p>
<ul>
<li>a new row in the Contacts table (unless the RawContact is associated to another existing Contact)</li>
<li>a new row in the RawContacts with account name and type set to null</li>
<li>0 or more rows in the Data table with a reference to the new Contacts and RawContacts Ids</li>
</ul>
<blockquote>
<p>ℹ️ It is possible to create RawContacts without any rows in the Data table. See the 
<strong>Data required</strong> section for more details.</p>
</blockquote>
<p>For example, creating 4 new contacts using the AOSP Android Contacts app results in;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Contact id: 4, displayName: First Local Contact
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Contact id: 5, displayName: Second Local Contact
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Contact id: 6, displayName: Third Local Contact
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>Contact id: 7, displayName: Third Local Contact
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>RawContact id: 4, accountName: null, accountType: null
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>RawContact id: 5, accountName: null, accountType: null
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>RawContact id: 6, accountName: null, accountType: null
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>RawContact id: 7, accountName: null, accountType: null
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>Data id: 15, rawContactId: 4, contactId: 4, data: First Local Contact
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>Data id: 16, rawContactId: 5, contactId: 5, data: Second Local Contact
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>Data id: 17, rawContactId: 6, contactId: 6, data: Third Local Contact
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>Data id: 18, rawContactId: 7, contactId: 7, data: Third Local Contact
</span></code></pre></div>
<p><strong>Local Contacts / RawContacts</strong></p>
<p>RawContacts inserted without an associated account are considered local or device-only raw contacts,
which are not synced.</p>
<p>The AOSP Contacts app hides the following UI fields when inserting or updating local raw contacts;</p>
<ul>
<li>Event</li>
<li>Relation</li>
<li>Group memberships</li>
</ul>
<p>However, the Google Contacts app does not hide any of the above for local raw contacts. Actually,
the Contacts Provider does not set any account restrictions with the above data kinds.</p>
<p><strong>Lollipop (API 22) and below</strong></p>
<p>When an Account is added, from a state where no accounts have yet been added to the system, the
Contacts Provider automatically sets all of the null <code>accountName</code> and <code>accountType</code> in the
RawContacts table to that Account's name and type;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>RawContact id: 4, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>RawContact id: 5, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>RawContact id: 6, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>RawContact id: 7, accountName: vestrel00@gmail.com, accountType: com.google
</span></code></pre></div>
<p>RawContacts inserted without an associated account will automatically get assigned to an account if
there are any available. This may take a few seconds, whenever the Contacts Provider decides to do
it. Dissociating RawContacts from Accounts will result in the Contacts Provider associating those
back to an Account.</p>
<p><strong>Marshmallow (API 23) and above</strong></p>
<p>The Contacts Provider no longer associates local contacts to an account when an account is or
becomes available. Local contacts remain local.</p>
<p><strong>Account removal</strong></p>
<p>Removing the Account will remove all of the associated rows in the <strong>local</strong> RawContact, Data, and 
Groups tables. This includes user Profile data in those tables.</p>
<p><strong>SyncColumns modifications</strong></p>
<p>This library supports modifying the <code>SyncColumns.ACCOUNT_NAME</code> and <code>SyncColumns.ACCOUNT_TYPE</code> of the
RawContacts table in some cases only. In some cases does not work as intended and produces unwanted
side-effects. It probably has something to do with syncing with remote servers and local Account /
sync data not matching up similar to errors on network requests if the system time does not match
network time.</p>
<p>The motivation behind changing the Account columns of the RawContacts table rows is that it would
allow users to;</p>
<ul>
<li>Associate local RawContacts (those that are not associated with an Account) to an Account,
  allowing syncing between devices.</li>
<li>Dissociate RawContacts from their Account such that they remain local to the device and not synced
  between devices.</li>
<li>Transfer RawContacts from one Account to another.</li>
</ul>
<p>When modifying the SyncColumns directly, the first works as intended. The second works with some
unwanted side-effects. The third does not work at all and produces unwanted side-effects.</p>
<p>These are the behaviors that I have found;</p>
<ol>
<li>Associating local RawContact A to Account X.<ul>
<li>Works as intended.</li>
<li>RawContact A is now associated with Account X and is synced across devices.</li>
</ul>
</li>
<li>Dissociating RawContact A (setting the SyncColumns' Account name and type to null) from Account X.<ul>
<li>Partially works with some unwanted-side effects.</li>
<li>Dissociates RawContact A from the device but not other devices.</li>
<li>RawContact A is no longer visible in the AOSP Contacts app UNLESS it retains the group
  membership to at least the default group from an Account.</li>
<li>At this point, RawContact A is a local contact. Changes to this local RawContact A will not be
  synced across devices.</li>
<li>If RawContact A is updated in another device and synced up to the server, then a syncing
  side-effect occurs because the RawContact A in the device is different from the RawContact A
  in the server. This causes the Contacts Provider to create another RawContact, resulting in a
  "duplicate". The two RawContact As may get aggregated to the same Contact depending on how
  similar they are.</li>
<li>If local RawContact A is re-associated back to Account X, it will still no longer be synced.</li>
</ul>
</li>
<li>Associating RawContact A from original Account X to Account Y.<ul>
<li>Does not work and have bad side-effects.</li>
<li>No change in other devices.</li>
<li>For Lollipop (API 22) and below, RawContact A is no longer visible in the AOSP Contacts app
  and syncing Account Y in system settings fails.</li>
<li>For Marshmallow (API 23) and above, RawContact A is no longer visible in the AOSP Contacts
  app. RawContact A is automatically deleted locally at some point by the Contacts Provider.
  Syncing Account Y in system settings succeeds.</li>
</ul>
</li>
</ol>
<p>Given that associating originally local RawContacts to an Account is the only thing that actually
works, it is the only function that will be exposed to consumers.</p>
<p>If consumers want to transfer RawContacts from one Account to another, they can create a copy of a
RawContact associated with the desired Account and then delete the original RawContact. Same idea
can be used to transform an Account-associated RawContact to a local RawContact. Perhaps we can
implement some functions in this library that does these things? We won't for now because the AOSP
Contacts app does not support these functions anyways. It can always be implemented later if the
community really wants. </p>
<p>Here are some other things to note.</p>
<ul>
<li>The Contacts Provider automatically creates a group membership to the default group (if exist)
   of the target Account when the account changes. </li>
<li>The Contacts Provider DOES NOT delete existing group memberships when the account changes.</li>
</ul>
<p><em>UPDATE: My hunch for insert copies then deleting non-null account-associated RawContacts turns 
to perform an "account move operation" turned out to be correct (case 2 and 3). This is what apps 
like the Google Contacts app does. Actually, Google Contacts app takes it even further by performing 
insert-delete operation regardless of whether the RawContact is associated to an account or not
(cases 1, 2, 3). It does not modify the <code>SyncColumns.ACCOUNT_NAME</code> and <code>SyncColumns.ACCOUNT_TYPE</code>
even though case 1 seems to be supported (for now). We should follow what Google Contacts is doing.
https://github.com/vestrel00/contacts-android/issues/168</em></p>
<h3 id="rawcontacts-deletion">RawContacts; Deletion<a class="headerlink" href="#rawcontacts-deletion" title="Permanent link">&para;</a></h3>
<p>Deleting a contact's Contacts row, RawContacts row(s), and associated Data row(s) are best explained
in the documentation in <code>ContactsContract.RawContacts</code>;</p>
<blockquote>
<p>When a raw contact is deleted, all of its Data rows as well as StatusUpdates,
AggregationExceptions, PhoneLookup rows are deleted automatically.</p>
<p>When all raw contacts associated with a Contacts row are deleted, the Contacts row itself is also
deleted automatically.</p>
<p>The invocation of resolver.delete(...), does not immediately delete a raw contacts row. Instead, 
it sets the ContactsContract.RawContactsColumns.DELETED flag on the raw contact and removes the 
raw contact from its aggregate contact. The sync adapter then deletes the raw contact from the
server and finalizes phone-side deletion by calling resolver.delete(...) again and passing the 
ContactsContract#CALLER_IS_SYNCADAPTER query parameter. </p>
<p>Some sync adapters are read-only, meaning that they only sync server-side changes to the phone,
but not the reverse. If one of those raw contacts is marked for deletion, it will remain on the
phone. However it will be effectively invisible, because it will not be part of any aggregate
contact.</p>
</blockquote>
<p><strong>TLDR</strong></p>
<p>To delete a contacts and all associated rows, simply delete all RawContact rows with the desired
Contacts id. Deletion of the Contacts row and associated Data row(s) will be done automatically by
the Contacts Provider.</p>
<p>Note that deleting a RawContacts row may not immediately delete the RawContacts row. In this case, 
it is marked as deleted and its reference to a contact id is nulled. The Contact may still exist if 
it still has at least one constituent RawContact that is not marked for deletion.</p>
<blockquote>
<p>ℹ️ A RawContact is marked for deletion as specified by <code>RawContactsColumns.DELETED</code>.</p>
</blockquote>
<p>Typically, deleting RawContacts immediately removes the row from the RawContacts table. However, 
RawContacts row remains and is simply marked for deletion UNTIL the sync adapters syncs the changes.
One of the reasons syncs do not occur is when the system sync settings are turned off for the 
Account or there is no network connection.</p>
<p>Such RawContacts should not be included in query results for Contacts. The AOSP and Google Contacts 
app also does not show them.</p>
<p>Note that local RawContacts rows (not associated with an Account) are deleted immediately as no sync
needs to occur.</p>
<h3 id="multiple-rawcontacts-per-contact">Multiple RawContacts Per Contact<a class="headerlink" href="#multiple-rawcontacts-per-contact" title="Permanent link">&para;</a></h3>
<p>Each row in the Contacts table may be associated with more than one row in the RawContacts table. 
The Contacts Provider may consolidate multiple contacts belonging to different accounts and combine 
them into a single entry in the Contacts table whilst maintaining the separate entries in the 
RawContacts table.</p>
<p>A more likely scenario that causes multiple RawContacts per Contact is when two or more Contacts are
"linked" (or "merged" for API 23 and below, or "joined" for API 22 and below).</p>
<h3 id="behavior-of-linkingmergingjoining-contacts-aggregationexceptions">Behavior of linking/merging/joining contacts (AggregationExceptions)<a class="headerlink" href="#behavior-of-linkingmergingjoining-contacts-aggregationexceptions" title="Permanent link">&para;</a></h3>
<p>The AOSP Contacts app terminology has changed over time;</p>
<ul>
<li>API 22 and below; join / separate</li>
<li>API 23; merge / unmerge</li>
<li>API 24 and above; link / unlink </li>
</ul>
<p>However, the internals have not changed; <code>KEEP_TOGETHER</code> / <code>KEEP_SEPARATE</code>. These operations are 
supported by the <code>ContactsContract.AggregationExceptions</code>.</p>
<p>For example, given the following tables,</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>### Contacts table
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>Contact id: 32, displayName: X, starred: 0, timesContacted: 1, lastTimeContacted: 1573071785456, customRingtone: content://media/internal/audio/media/109, sendToVoicemail: 0
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Contact id: 33, displayName: Y, starred: 1, timesContacted: 2, lastTimeContacted: 1573071750624, customRingtone: content://media/internal/audio/media/115, sendToVoicemail: 1
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>### RawContacts table
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>RawContact id: 30, contactId: 32, displayName: X, accountName: x@x.com, accountType: com.google, starred: 0, timesContacted: 1, lastTimeContacted: 1573071785456, customRingtone: content://media/internal/audio/media/109, sendToVoicemail: 0
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>RawContact id: 31, contactId: 33, displayName: Y, accountName: y@y.com, accountType: com.google, starred: 1, timesContacted: 2, lastTimeContacted: 1573071750624, customRingtone: content://media/internal/audio/media/115, sendToVoicemail: 1
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>### Data table
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>Data id: 57, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/group_membership, data1: 18
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>Data id: 58, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/name, data1: X, isPrimary: 1, isSuperPrimary: 1
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>Data id: 59, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/email_v2, data1: x@x.com
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>Data id: 60, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/email_v2, data1: xx@x.com, isPrimary: 1, isSuperPrimary: 1
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>Data id: 63, rawContactId: 31, contactId: 33, mimeType: vnd.android.cursor.item/group_membership, data1: 6
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>Data id: 64, rawContactId: 31, contactId: 33, mimeType: vnd.android.cursor.item/name, data1: Y, isPrimary: 1, isSuperPrimary: 1
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>Data id: 65, rawContactId: 31, contactId: 33, mimeType: vnd.android.cursor.item/email_v2, data1: y@y.com
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>Data id: 66, rawContactId: 31, contactId: 33, mimeType: vnd.android.cursor.item/email_v2, data1: yy@y.com, isPrimary: 1, isSuperPrimary: 1
</span></code></pre></div>
<p>When Contact <strong>X</strong> links/merges/joins Contact <strong>Y</strong>, the tables becomes;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>### Contacts table
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Contact id: 32, displayName: X, starred: 1, timesContacted: 2, lastTimeContacted: 1573071785456, customRingtone: content://media/internal/audio/media/109, sendToVoicemail: 0
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>### RawContacts table
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>RawContact id: 30, contactId: 32, displayName: X, accountName: x@x.com, accountType: com.google, starred: 0, timesContacted: 1, lastTimeContacted: 1573071785456, customRingtone: content://media/internal/audio/media/109, sendToVoicemail: 0
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>RawContact id: 31, contactId: 32, displayName: Y, accountName: y@y.com, accountType: com.google, starred: 1, timesContacted: 2, lastTimeContacted: 1573071750624, customRingtone: content://media/internal/audio/media/115, sendToVoicemail: 1
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>### Data table
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>Data id: 57, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/group_membership, data1: 18
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>Data id: 58, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/name, data1: X, isPrimary: 1, isSuperPrimary: 1
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>Data id: 59, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/email_v2, data1: x@x.com
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>Data id: 60, rawContactId: 30, contactId: 32, mimeType: vnd.android.cursor.item/email_v2, data1: xx@x.com, isPrimary: 1, isSuperPrimary: 0
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>Data id: 63, rawContactId: 31, contactId: 32, mimeType: vnd.android.cursor.item/group_membership, data1: 6
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>Data id: 64, rawContactId: 31, contactId: 32, mimeType: vnd.android.cursor.item/name, data1: Y, isPrimary: 1, isSuperPrimary: 0
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>Data id: 65, rawContactId: 31, contactId: 32, mimeType: vnd.android.cursor.item/email_v2, data1: y@y.com
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>Data id: 66, rawContactId: 31, contactId: 33, mimeType: vnd.android.cursor.item/email_v2, data1: yy@y.com, isPrimary: 1, isSuperPrimary: 0
</span></code></pre></div>
<p><strong>What changed?</strong></p>
<p>Contact Y's row has been deleted and its column values have been merged into Contact X row. If the 
reverse occurred (Contact Y merged with Contact X), Contact Y's row would still be deleted. The 
difference is that Contact X's display name will be set to Contact Y's display name, which is
done by the AOSP Contacts app manually by setting Contact Y's Data name row to be the "default" 
(isPrimary and isSuperPrimary both set to 1).</p>
<blockquote>
<p>ℹ️ The AggregationExceptions table records the linked RawContacts' IDs in ascending order 
regardless of the order used in RAW_CONTACT_ID1 and RAW_CONTACT_ID2 at the time of merging.</p>
</blockquote>
<p>The RawContacts and Data table remains the same except the joined contactId column values have now
been changed to the id of Contact X. All Data rows' isSuperPrimary value has been set to 0 though 
the isPrimary columns remain the same. In other words, this clears any "default" set before the 
link. These are done automatically by the Contacts Provider during the link operation.</p>
<p>What is not done automatically by the Contacts Provider is that the name row of former Contact X is
set as the default. The AOSP Contacts app does this manually. The Contacts Providers automatically
sets the Contact display name to whatever the default name row is for the Contact, if available.
For more info on Contact display name resolution, read the <strong>Contact Display Name and Default Name
Rows</strong> section.</p>
<blockquote>
<p>ℹ️ Display name resolution is different for APIs below 21 (pre-lollipop).</p>
</blockquote>
<p>The display name of the RawContacts remain the same.</p>
<p>The Groups table remains unmodified.</p>
<p><strong>Options updates</strong></p>
<p>Changes to the options (starred, timesContacted, lastTimeContacted, customRingtone, and 
sendToVoicemail) of a RawContact may affect the options of the parent Contact. On the other hand, 
changes to the options of the parent Contact will be propagated to all child RawContact options.</p>
<p><strong>Photo updates</strong></p>
<p>A RawContact may have a full-sized photo saved as a file and a thumbnail version of that saved in
the Data table in a photo mimetype row. A Contact's full-sized photo and thumbnail are simply
references to the "chosen" RawContact's full-sized photo and thumbnail (though the URIs may differ).</p>
<blockquote>
<p>ℹ️ When removing the photo in the AOSP contacts app, the photo data row is not immediately 
deleted, though the <code>PHOTO_FILE_ID</code> is immediately set to null. This may result in the <code>PHOTO_URI</code>
and <code>PHOTO_THUMBNAIL_URI</code> to still have a valid image uri even though the photo has been 
"removed". This library immediately deletes the photo data row, which seems to work perfectly.</p>
</blockquote>
<p><strong>Data inserts</strong></p>
<p>In the AOSP Contacts app, Data inserted in combined (raw) contacts mode will be associated to the
first RawContact in the list sorted by the RawContact ID. </p>
<blockquote>
<p>ℹ️ This may not be the same as the RawContact referenced by <code>ContactsColumns.NAME_RAW_CONTACT_ID</code>.</p>
</blockquote>
<p><strong>UI changes?</strong></p>
<p>The AOSP Contacts App does not display the groups field when displaying / editing Contacts that
have multiple RawContacts (linked/merged/joined) in combined mode. However, it does allow editing 
individual RawContact Data rows in which case the groups field is displayed and editable.</p>
<p>In the AOSP Contacts app, the name attribute used comes from the name row with IS_SUPER_PRIMARY
set to true. This and all other "unique" mimetypes (organization) and non-unique mimetypes (email)
per RawContact are shown only if they are not blank.</p>
<p><strong>Showing multiple RawContact's data in the same edit screen (combined mode)</strong></p>
<p>In older version of the AOSP, Android Open Source Project (AOSP) Contacts app, data from multiple
RawContacts was being shown in the same edit screen. This caused a lot of confusion about which
data belonged to which RawContact. Newer versions of AOSP Contacts only allow editing one RawContact
at a time to avoid confusion. Though, several RawContacts' data are still shown (not-editable) 
in the same screen.</p>
<h3 id="aggregationexceptions-table">AggregationExceptions table<a class="headerlink" href="#aggregationexceptions-table" title="Permanent link">&para;</a></h3>
<p>Given the following Contacts and their RawContacts;</p>
<ul>
<li>Contact A<ul>
<li>RawContact 1</li>
</ul>
</li>
<li>Contact B<ul>
<li>RawContact 2</li>
</ul>
</li>
<li>Contact C<ul>
<li>RawContact 3</li>
</ul>
</li>
<li>Contact D<ul>
<li>RawContact 4</li>
</ul>
</li>
</ul>
<p>Linking one by one in this order;</p>
<ul>
<li>Contact B link Contact A</li>
<li>Contact C link Contact D</li>
<li>Contact C link Contact B</li>
</ul>
<p>Results in the following AggregationExceptions rows respectively;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Aggregation exception id: 430, type: 1, rawContactId1: 1, rawContactId2: 2
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Aggregation exception id: 430, type: 1, rawContactId1: 1, rawContactId2: 2
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Aggregation exception id: 432, type: 1, rawContactId1: 3, rawContactId2: 4
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Aggregation exception id: 436, type: 1, rawContactId1: 1, rawContactId2: 2
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Aggregation exception id: 439, type: 1, rawContactId1: 1, rawContactId2: 3
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>Aggregation exception id: 442, type: 1, rawContactId1: 1, rawContactId2: 4
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Aggregation exception id: 440, type: 1, rawContactId1: 2, rawContactId2: 3
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>Aggregation exception id: 443, type: 1, rawContactId1: 2, rawContactId2: 4
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>Aggregation exception id: 444, type: 1, rawContactId1: 3, rawContactId2: 4
</span></code></pre></div>
<p>There is a pattern here. RawContact ids are sorted in ascending order and linked from least to 
greatest exhaustively but no double links (1-2 is the same as 2-1).</p>
<ul>
<li>RawContact 1 has a row with RawContact 2, 3, and 4.</li>
<li>RawContact 2 has a row with RawContact 3 and 4.</li>
<li>RawContact 3 has a row with RawContact 4.</li>
</ul>
<p>Linking all in one go;</p>
<ul>
<li>Contact C link Contact A, B, D</li>
</ul>
<p>Results in the same AggregationExceptions rows.</p>
<p>Unlinking results in the same AggregationExceptions rows <strong>except</strong> the type is 2 
(TYPE_KEEP_SEPARATE).</p>
<h3 id="data-table">Data Table<a class="headerlink" href="#data-table" title="Permanent link">&para;</a></h3>
<p>The Data table uses generic column names (e.g. "data1", "data2", ...) using the column "mimetype" to
distinguish the type of data in that generic column. For example, the column name of 
<code>StructuredName.DISPLAY_NAME</code> is the same as <code>Email.ADDRESS</code>, which is "data1". </p>
<p>Each row in the Data table consists of a piece of RawContact data (e.g. a phone number), its
"mimetype", and the associated RawContact and Contact id. A row does not contain all of the data for
a contact.</p>
<p>RawContacts may only have one row of certain mimetypes and may have multiple rows of other 
mimetypes. Here is the list.</p>
<p><strong>Unique mimetype per RawContact</strong></p>
<ul>
<li>Name (StructuredName)</li>
<li>Nickname</li>
<li>Note</li>
<li>Organization</li>
<li>Photo</li>
<li>SipAddress</li>
</ul>
<p><strong>Non-unique mimetype per Raw Contact</strong></p>
<ul>
<li>Address (StructuredPostal)</li>
<li>Email</li>
<li>Event</li>
<li>GroupMembership</li>
<li>Im</li>
<li>Phone</li>
<li>Relation</li>
<li>Website</li>
</ul>
<p>Although some mimetypes are unique per RawContact, none of those mimetypes are unique per Contact
because a Contact is an aggregate of one or more RawContacts!</p>
<h3 id="data-primary-and-super-primary-rows">Data Primary and Super Primary Rows<a class="headerlink" href="#data-primary-and-super-primary-rows" title="Permanent link">&para;</a></h3>
<p>As per documentation, for a set of data rows with the same mimetype (e.g. a set of emails), there 
should only be one primary data row (e.g. email) per RawContact and one super primary data row per
Contact. Furthermore, a data row that is super primary must also be primary.</p>
<p>Unfortunately, the Contacts Provider does not do any data set validation for the Data columns 
<code>IS_PRIMARY</code> and <code>IS_SUPER_PRIMARY</code>. This means that it is possible to set more than one data row of
the same mimetype as primary for the same RawContact and super primary for the same aggregate
Contact. It is also possible to set a data row as super primary but not primary. Upholding the the
contract is left to us... </p>
<p>For example, given this relationship;</p>
<ul>
<li>Contact<ul>
<li>RawContact X<ul>
<li>Email A</li>
<li>Email B</li>
</ul>
</li>
<li>RawContact Y<ul>
<li>Email C</li>
<li>Email D</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>When Emails A, B, C, and D are inserted with the RawContacts or after the RawContacts have been 
created, we get the following state;</p>
<table>
<thead>
<tr>
<th><strong>Email</strong></th>
<th><strong>Primary</strong></th>
<th><strong>Super Primary</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>B</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>C</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>D</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>The state does not change when RawContact X is linked with RawContact Y.</p>
<p>After setting Email A as the "default" email, it becomes primary and super primary;</p>
<table>
<thead>
<tr>
<th><strong>Email</strong></th>
<th><strong>Primary</strong></th>
<th><strong>Super Primary</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>B</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>C</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>D</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Then setting Email B as the default email, it becomes primary and super primary. Email A is no
longer primary or super primary.</p>
<table>
<thead>
<tr>
<th><strong>Email</strong></th>
<th><strong>Primary</strong></th>
<th><strong>Super Primary</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>B</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>C</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>D</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Then setting Email C as the default email, it becomes primary and super primary. Email B is still
primary because it belongs to a different RawContact than Email C. However, Email B is no longer the
super primary as there can only be one per aggregate Contact.</p>
<table>
<thead>
<tr>
<th><strong>Email</strong></th>
<th><strong>Primary</strong></th>
<th><strong>Super Primary</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>B</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>C</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>D</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Then setting Email D as the default email, it becomes primary and super primary. Email C is no 
longer primary or super primary.</p>
<table>
<thead>
<tr>
<th><strong>Email</strong></th>
<th><strong>Primary</strong></th>
<th><strong>Super Primary</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>B</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>C</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>D</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Then clearing the default email D, removes its primary and super primary status. However, email B 
remains a primary but not a super primary.</p>
<table>
<thead>
<tr>
<th><strong>Email</strong></th>
<th><strong>Primary</strong></th>
<th><strong>Super Primary</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>B</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>C</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>D</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>The above behavior is observed from the AOSP Contacts app. The "super primary" data of an 
aggregate Contact is referred to as the "default".</p>
<blockquote>
<p>ℹ️ At this point, the AOSP Contacts app still shows email B as the first email in the list even
though it isn't the "default" (super primary) because it is still a primary. This adds a bit of
confusion in my opinion, especially when more than 2, 3, or 4 RawContacts are linked. A "fix" 
would be to only order the list of emails using "super primary" instead of "super primary" and 
"primary". OR to remove the primary status of the data set of all linked RawContacts.</p>
<p>One benefit of the AOSP Contacts implementation of this is that it retains the primary status
when unlinking RawContacts. </p>
<p>This library should follow what the AOSP Contacts app is doing in spirit of recreating the
AOSP experience as closely as possible, even if it seems like a lesser experience.</p>
</blockquote>
<h3 id="data-table-joins">Data Table Joins<a class="headerlink" href="#data-table-joins" title="Permanent link">&para;</a></h3>
<p>All columns accessible via cursors returned from Data table queries are specified in
<code>DataColumnsWithJoins</code>, which includes the <code>DataColumns</code>, <code>ContactsColumns</code>, and
<code>ContactOptionsColumns</code>. In code, mentions of the "Data table" typically refers to the joined table.</p>
<p>The <code>DataColumns</code> gives us access to all of the columns in the Data table. All other joined columns,
including the <code>ContactsColumns</code> are appended to each row in the query. This means that the 
<code>ContactsColumns</code>; <code>DISPLAY_NAME</code>, <code>PHOTO_URI</code>, and <code>PHOTO_THUMBNAIL_URI</code> are repeated for all Data
rows belonging to the same Contact.</p>
<p>The <code>ContactOptionsColumns</code> values joined with the Data table are the values of the Contact, not
the RawContact that the Data row belongs to! The same applies to the "display_name".</p>
<h3 id="data-updates">Data Updates<a class="headerlink" href="#data-updates" title="Permanent link">&para;</a></h3>
<p>A new row in the Data table is created for each new piece of data (e.g. email address) entered for 
the contact. </p>
<p>Removing a piece of existing data results in the deletion of the row in the Data table if that row
no longer contains any meaningful data (no meaningful non-null "datax" columns left). This is the 
behavior of the AOSP Android Contacts app. Therefore, querying for null fields is not possible. 
For example, there may be no Data rows that exist where the email address is null. Thus, a query to 
search for all contacts with null email address may return 0 contacts even if there are some
contacts without email addresses.</p>
<h3 id="data-required">Data Required<a class="headerlink" href="#data-required" title="Permanent link">&para;</a></h3>
<p>Creating blank RawContacts without email address (or other fields), results in no rows in the Data
table for the email address, and all other fields. There are a few exceptions. The following 
Data rows are automatically created for all contacts, if not provided;</p>
<ul>
<li>Group membership, underlying value defaults to the account's default system group</li>
<li>Name, underlying value defaults to null</li>
<li>Nickname, underlying value defaults to null</li>
<li>Note, underlying value defaults to null</li>
</ul>
<blockquote>
<p>ℹ️ All of the above rows are only automatically created for RawContacts that are associated
with an Account.</p>
</blockquote>
<p>If a valid account is provided, the default (auto add) system group membership row is automatically
created immediately by the Contacts Provider at the time of contact insertion. The name, nickname,
and note are automatically created at a later time.</p>
<p>If a valid account is not provided, none of the above data rows are automatically created.</p>
<p><strong>Blank RawContacts</strong></p>
<p>The Contacts Providers allows for RawContacts that have no rows in the Data table (let's call them
"blanks") to exist. The AOSP Contacts app does not allow insertion of new RawContacts without at
least one data row. It also deletes blanks on update. Despite seemingly not allowing blanks, the
AOSP Contacts app shows them.</p>
<p>There are two scenarios where blanks may exist.</p>
<ol>
<li>Contact with RawContact(s) with no Data row(s).<ul>
<li>In this case, the Contact is blank as well as its RawContact(s).</li>
</ul>
</li>
<li>Contact that has RawContact with Data row(s) and a RawContact with no Data row.<ul>
<li>In this case, the Contact and the RawContact with Data row(s) are not blank but the RawContact
with no Data row is blank.</li>
</ul>
</li>
</ol>
<h3 id="data-structuredname">Data <code>StructuredName</code><a class="headerlink" href="#data-structuredname" title="Permanent link">&para;</a></h3>
<p>The <code>DISPLAY_NAME</code> is the unstructured representation of the name. It is made up of structured
components; <code>PREFIX</code>, <code>GIVEN_NAME</code>, <code>MIDDLE_NAME</code>, <code>FAMILY_NAME</code>, and <code>SUFFIX</code>.</p>
<p>When updating or inserting a row;</p>
<ul>
<li>If the display name is null and there are non-null structured components provided (e.g. given and
  family name), the Contacts Provider will automatically set the display name by combining the
  structured components.</li>
<li>If the display name is not null and all structured components are null, the Contacts Provider
  automatically (to the best of its ability) derive the values for all the structured components.</li>
<li>If the display name and structured components are not null, the Contacts Provider does nothing
  automatically.</li>
</ul>
<h3 id="data-structuredpostal">Data <code>StructuredPostal</code><a class="headerlink" href="#data-structuredpostal" title="Permanent link">&para;</a></h3>
<p>The <code>FORMATTED_ADDRESS</code> is the unstructured representation of the postal address. It is made up of
structured components; <code>STREET</code>, <code>POBOX</code>, <code>NEIGHBORHOOD</code>, <code>CITY</code>, <code>REGION</code>, <code>POSTCODE</code>, and
<code>COUNTRY</code>.</p>
<p>When updating or inserting a row;</p>
<ul>
<li>If the formatted address is null and there are non-null structured components provided (e.g.
  street and city), the Contacts Provider will automatically set the formatted address by combining
  the structured components.</li>
<li>If the formatted address is not null and all structured components are null, the Contacts Provider
  automatically sets the street value to the formatted address.</li>
<li>If the formatted address and structured components are not null, the Contacts Provider does
  nothing automatically.</li>
</ul>
<h3 id="groups-table-accounts">Groups Table &amp; Accounts<a class="headerlink" href="#groups-table-accounts" title="Permanent link">&para;</a></h3>
<p>Contacts are assigned to one or more groups via the <code>GroupMembership</code>. It typically looks like this;</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Group id: 1, systemId: Contacts, isReadOnly: 1, title: My Contacts, favorites: 0, autoAdd: 1, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Group id: 2, systemId: null, isReadOnly: 1, title: Starred in Android, favorites: 1, autoAdd: 0, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Group id: 3, systemId: Friends, isReadOnly: 1, title: Friends, favorites: 0, autoAdd: 0, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>Group id: 4, systemId: Family, isReadOnly: 1, title: Family, favorites: 0, autoAdd: 0, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>Group id: 5, systemId: Coworkers, isReadOnly: 1, title: Coworkers, favorites: 0, autoAdd: 0, accountName: vestrel00@gmail.com, accountType: com.google
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>Group id: 6, systemId: null, isReadOnly: 0, title: Custom Group, favorites: 0, autoAdd: 0, accountName: vestrel00@gmail.com, accountType: com.google
</span></code></pre></div>
<p>The actual groups are in a separate table; Groups. Each group is associated with an Account. The 
AOSP Contacts app does not allow for Groups to exist without an Account. However, other apps such as
the Google Contacts app allows for Groups with a null account. The Contacts Provider also allows
this. Therefore, we will allow Group without accounts in this library and let library users decide
if they want to restrict groups to non-null accounts.</p>
<p>Each account will have its own set of the above system groups. This means that there may be multiple
groups with the same title belonging to different accounts.</p>
<p>System ids are typically Contacts, Friends, Family, and Coworkers. These ids are typically the same
across all copies of Android. Notes;
- The Contacts system group is the default group in which all raw contacts of an account belongs to.
  Therefore, it is typically hidden when showing the list of groups in the UI.
- The starred (favorites) group is not a system group as it has null system id. However, it behaves
  like one in that it is read only and it comes with most (if not all) copies of the AOSP app.</p>
<p>Removing the Account will delete all of the associated rows in the Groups table.</p>
<p><strong>Groups, duplicate titles</strong></p>
<p>The Contacts Provider allows multiple groups with the same title (case-sensitive comparison) 
belonging to the same account to exist. In older versions of Android, the AOSP Contacts app 
allows the creation of new groups with existing titles. In newer versions, duplicate titles are not 
allowed. Therefore, this library does not allow for duplicate titles.</p>
<blockquote>
<p>ℹ️ In newer versions, the group with the duplicate title gets deleted either automatically by the 
Contacts Provider or when viewing groups in the AOSP Contacts app. It's not an immediate failure 
on insert or update. This could lead to bugs!</p>
</blockquote>
<h3 id="groups-table-groupmemberships-data-table">Groups Table &amp; GroupMemberships (Data Table)<a class="headerlink" href="#groups-table-groupmemberships-data-table" title="Permanent link">&para;</a></h3>
<p>There may be multiple groups with the same title from different accounts. Therefore, the group
membership should point to the group belonging to the same account as the raw contact. The AOSP
Contacts app displays only the groups belonging to the selected account.</p>
<p>Updating group memberships of existing raw contacts seem to be almost instant. All raw contacts must
be a part of at least the default group (system id is "Contacts"). Raw contacts with no group
membership will be asynchronously added to the Account's default group by the Contacts Provider.</p>
<p>Membership to the default group should never be deleted!</p>
<h3 id="starred-in-android-favorites">Starred in Android (Favorites)<a class="headerlink" href="#starred-in-android-favorites" title="Permanent link">&para;</a></h3>
<p>When the <code>ContactOptionsColumns.STARRED</code> column of a Contact in the Contacts table is set to true,
the Contacts Provider automatically adds a group membership to the favorites group for all 
RawContacts linked to the Contact. Setting <code>STARRED</code> to false removes all group memberships to the
favorites group.</p>
<p>The <code>STARRED</code> is interdependent with group memberships to the favorites group. Adding a group 
membership to the favorites group results in <code>STARRED</code> being set to true. Removing the membership 
sets it to false.</p>
<p>Raw contacts that are not associated with an account do not have any group memberships. Even though
these raw contacts may not have a membership to the favorites group, they may still be "starred"
(favorited) via the <code>ContactOptionsColumns.STARRED</code> column in the Contacts table, which is not
dependent on the existence of a favorites group membership.</p>
<p><strong>Refresh RawContact instances after changing the starred value.</strong> Otherwise, performing an update 
on the RawContact with a stale set of group memberships may revert the star/unstar operation. For 
example, query returns a starred RawContact -&gt; set starred to false -&gt; update RawContact (still 
containing a group membership to the favorites group) -&gt; starred will be set back to true.</p>
<h3 id="group-memberships-local-rawcontacts">Group memberships &amp; Local RawContacts<a class="headerlink" href="#group-memberships-local-rawcontacts" title="Permanent link">&para;</a></h3>
<p>Local RawContacts may have a group membership to the default system group of an Account without
being associated with the Account...</p>
<p>The AOSP Contacts app may not have an edit-RawContact option for newly inserted RawContacts that
have no group membership to the default group when an Account is available. Though, edits can still
be made in other ways. Instead, an option to "Add to contacts" is shown that adds a membership to
the default group but does not associate the raw contact to the Account that owns the group. The
edit UI does not show the group membership field.</p>
<p>Weirdly, this only occurs when there is exactly only one Account. If there are no Accounts or there
are two or more Accounts, then this does not occur. Also, this does not occur for a Contact with a
RawContact that has a group membership AND a RawContact that has no group membership.</p>
<h3 id="groups-deletion">Groups; Deletion<a class="headerlink" href="#groups-deletion" title="Permanent link">&para;</a></h3>
<p>Similar to deleting RawContacts, deleting a Groups row may not immediately delete the Groups row. 
In this case, it is marked as deleted. </p>
<blockquote>
<p>ℹ️ A Group is marked for deletion as specified by <code>GroupsColumns.DELETED</code>.</p>
</blockquote>
<p>Typically, deleting Groups immediately removes the row from the Groups table. However,
Groups row remains and is simply marked for deletion UNTIL the sync adapters syncs the changes.
One of the reasons syncs do not occur is when the system sync settings are turned off for the
Account or there is no network connection.</p>
<p>Such Groups should not be included in query results for Contacts. The AOSP and Google Contacts app 
also does not show them.</p>
<p>Note that local Groups rows (not associated with an Account) are deleted immediately as no sync
needs to occur.</p>
<h3 id="groups-ui">Groups; UI<a class="headerlink" href="#groups-ui" title="Permanent link">&para;</a></h3>
<p>In newer Android versions of the AOSP Contacts app, "groups" are now being referred to as
"labels". However, the underlying code still uses groups. Google is probably just trying to make it
more user friendly by calling it label instead of group.</p>
<h3 id="user-profile">User Profile<a class="headerlink" href="#user-profile" title="Permanent link">&para;</a></h3>
<p>There exist one (profile) Contacts row that identifies the user;
<code>ContactsColumns.IS_USER_PROFILE</code>. There is at least one RawContacts row that is associated with the
user profile; <code>RawContactsColumns.RAW_CONTACT_IS_USER_PROFILE</code>. Associated RawContacts may or may
not be associated with an Account. The RawContacts row(s) may have rows in the Data table as usual.
These profile table rows have special IDs that differ from regular rows. See<br />
<code>ContactsContract.isProfileId</code>.</p>
<blockquote>
<p>ℹ️ The Contacts Provider will throw an IllegalArgument exception when attempting to include
<code>ContactsColumns.IS_USER_PROFILE</code> and <code>RawContactsColumns.RAW_CONTACT_IS_USER_PROFILE</code> columns
in Data table queries. I have not yet tried including these columns in the Contacts or RawContacts
table queries.</p>
</blockquote>
<p>The profile Contact row may not be merged / linked with other contacts and do not belong to any
group (favorites / starred).</p>
<p>Profile rows in the Contacts, RawContacts, and Data table are not visible via queries in the
respective tables. They will not be in the resulting cursor. To get the profile Contacts table rows,
query the <code>Profile.CONTENT_URI</code>. To get profile RawContacts table rows, query the
<code>Profile.CONTENT_RAW_CONTACTS_URI</code>. To get the profile Data table rows, query the
<code>Profile.CONTENT_RAW_CONTACTS_URI</code> appended with the RawContact id and
<code>RawContacts.Data.CONTENT_DIRECTORY</code>.</p>
<p>To insert a new profile RawContact, use <code>Profile.CONTENT_RAW_CONTACTS_URI</code>. It will automatically
be associated with the profile Contact. If the profile Contact does not yet exist, it will be<br />
created automatically.</p>
<p>To insert a new profile Data row, either;</p>
<ul>
<li>insert to the <code>Profile.CONTENT_RAW_CONTACTS_URI</code> appended with the RawContact id and
<code>RawContacts.Data.CONTENT_DIRECTORY</code></li>
<li>insert to the Data table directly, referencing the RawContact id</li>
</ul>
<p>Same rules apply to all table rows. If all profile RawContacts table rows have been deleted, then
associated Contacts and Data table rows will automatically be deleted.</p>
<p><strong>Profile aggregation</strong></p>
<p>The RawContacts of a (Contact) Profile are linked via the indexed rows;
<code>Profile.CONTENT_RAW_CONTACTS_URI</code>. Therefore, the AggregationsExceptions table is not used here.</p>
<p><strong>Profile and users</strong></p>
<p>Note that as of Android 5 Lollipop, there may exist multiple users in a device. Each user has a
separate list of accounts and contact data. This also means that each user has a separate (local)
profile contact.</p>
<p><strong>Profile and Accounts</strong></p>
<p>According to the <code>Profile</code> documentation; "... each account (including data set, if applicable) on
the device may contribute a single raw contact representing the user's personal profile data from
that source."</p>
<p>In other words, one account can have one profile RawContact. Whether or not profile RawContacts
associated to an Account can be carried over and synced across devices and users is up to the
Contacts Provider / Sync provider for that Account.</p>
<blockquote>
<p>ℹ️ From my experience, profile RawContacts associated to an Account is not carried over / synced
across devices or users.</p>
</blockquote>
<p>Despite the documentation of "one profile RawContact per one Account", the Contacts Provider allows
for multiple RawContacts per Account, including multiple local RawContacts (no Account). Thus, we
should let consumers exploit this but set defaults to be one-for-one.</p>
<p>Creating / setting up the profile in the AOSP Contacts app results in the creation of a local
RawContact (not associated with an Account) even if there are available Accounts.</p>
<p>The Contacts Provider does not associate local contacts to an account when an account is or becomes
available (regardless of API level).</p>
<p>Removing the Account will delete all of the associated rows in the Contact, RawContact, Data, and
Groups tables. This includes user Profile data in those tables.</p>
<p><strong>Profile permissions</strong></p>
<p>Profile permissions (READ_PROFILE and WRITE_PROFILE) have been removed since API 23. However, they
are still required for API 22 and below. Reading and writing the profile is included in the Contacts
permissions. There is no need to ask for profile permissions at runtime because prior to API 23,
permissions in the AndroidManifest have to be accepted prior to installation.</p>
<h3 id="syncing-data-sync-adapters">Syncing Data / Sync Adapters<a class="headerlink" href="#syncing-data-sync-adapters" title="Permanent link">&para;</a></h3>
<p>First, it’s good to know the official documentation of sync adapters; 
https://developer.android.com/guide/topics/providers/contacts-provider#SyncAdapters</p>
<p>Now, let’s ingest the official docs… Data belonging to a RawContact that is associated with a Google 
account will be available anywhere the Google account is used; in any Android or iOS device, a web 
browser, etc… Data is synced by Google’s sync adapters to and from their remote servers. Syncing 
depends on the account sync settings, which can be configured in the AOSP system settings app and 
possibly through some remote configuration.</p>
<p>This library does not provide any sync adapters. Instead, it relies on existing sync adapters to do 
the syncing. Sync adapters and syncing are really out of scope of this library. Syncing is its own 
thing that typically happens outside of an application UI. This library is focused on reading and 
writing AOSP and custom data to and from the local database. Syncing the local database to and 
from a remote service is a different story altogether =)</p>
<h3 id="custom-data-mimetypes">Custom Data / MimeTypes<a class="headerlink" href="#custom-data-mimetypes" title="Permanent link">&para;</a></h3>
<p>First, it’s good to know the official documentation of custom data rows; 
https://developer.android.com/guide/topics/providers/contacts-provider#CustomData</p>
<p>Now, let’s ingest the official docs… Custom mimetypes do not belong to the AOSP Contacts Provider 
mimetype set (e.g. address, email, phone, etc). The Contacts Provider allows for the creation of 
new / custom mimetypes. This is especially useful for other apps (Google Contacts, Facebook, 
Twitter, WhatsApp, etc) that want to attach extra pieces of data to a particular RawContact.</p>
<p>Custom data are NOT synced, including those that belong to RawContacts that are associated with an 
Account. Custom sync adapters are required to sync custom data. This library currently does NOT 
provide custom sync adapters to sync custom data!</p>
<p>Custom data from other apps such as Facebook, Twitter, WhatsApp, etc may or may not be synced. It 
all depends on those applications and their custom sync adapters (if they have any) and sync settings.</p>
<p>For insight on how aforementioned social media services may be syncing their data, read through the 
official documentation; https://developer.android.com/guide/topics/providers/contacts-provider#SocialStream</p>
<h3 id="unused-contactscontract-stuff">Unused ContactsContract Stuff<a class="headerlink" href="#unused-contactscontract-stuff" title="Permanent link">&para;</a></h3>
<p>We are currently not utilizing these things because I haven't found usages of them while using the
AOSP Contacts app. They are probably working behind the scenes but until we find uses for these,
let's leave it out because <a href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it">YAGNI</a>.</p>
<ul>
<li><code>Settings</code>. Contacts-specific settings for various Accounts (settings for an Account).<ul>
<li>Might be useful to add this for <code>SHOULD_SYNC</code> and <code>UNGROUPED_VISIBLE</code>.</li>
</ul>
</li>
<li><code>ContactsColumns.IN_VISIBLE_GROUP</code> + <code>Groups.GROUP_VISIBLE</code>. Flag indicating if the contacts
   belonging to this group should be visible in any user interface.</li>
</ul>
<h2 id="java-support">Java Support<a class="headerlink" href="#java-support" title="Permanent link">&para;</a></h2>
<p>This library is intended to be Java-friendly. The policy is that we should attempt to write 
Java-friendly code that does not increase lines of code by much or add external dependencies to 
cater exclusively to Java users.</p>
<h2 id="creating-entities-data-class">Creating Entities &amp; data class<a class="headerlink" href="#creating-entities-data-class" title="Permanent link">&para;</a></h2>
<p>First, consumers are not allowed to create immutable entities. Those must come from the API itself
to ensure data integrity. Whether or not we will change this in the future is debatable =)</p>
<p>~~Consumers are able to set read-only and private or internal variables though because all <code>Entity</code> 
implementations are data classes. Data classes provide a <code>copy</code> function that allows for setting any
property no matter their visibility and even if the constructor is private. As a matter of fact, 
setting the constructor of a <code>data class</code> as <code>private</code> gives this warning by Android Studio: 
"Private data class constructor is exposed via the 'copy' method.~~</p>
<p>~~There is currently no way to disable the <code>copy</code> function of data classes (that I know of). The only
thing we can do is to provide documentation to consumers, insisting against the use of the <code>copy</code>
method as it may lead to unwanted side effects when updating and deleting contacts.~~</p>
<blockquote>
<p>~~ℹ️ We could just use regular classes instead of data classes but entities should be data classes
because it is what they are (know what I mean?!). Also, I'd hate to have to generate equals and
hashcode functions for them, which will make the code harder to maintain. Though, we might do this
anyways at some point if we want to make it possible for a mutable entity to equal an immutable
entity. Time will tell =)~~</p>
<p>https://discuss.kotlinlang.org/t/data-class-copy-visibility-modifier/19746</p>
</blockquote>
<p>As of https://github.com/vestrel00/contacts-android/issues/358, the above notes that have been
~~strikethrough~~ no longer apply =) </p>
<h2 id="immutable-vs-mutable-entities">Immutable vs Mutable Entities<a class="headerlink" href="#immutable-vs-mutable-entities" title="Permanent link">&para;</a></h2>
<p>This library provides <strong>true immutability</strong> for immutable entities.</p>
<p>Take a look at the current (simplified) hierarchy;</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">ContactEntity</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rawContacts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">RawContactEntity</span><span class="o">&gt;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="p">}</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Contact</span><span class="p">(</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">rawContacts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">RawContact</span><span class="o">&gt;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ContactEntity</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MutableContact</span><span class="p">(</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">rawContacts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MutableRawContact</span><span class="o">&gt;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ContactEntity</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">RawContactEntity</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">RawContact</span><span class="p">(</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">addresses</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RawContactEntity</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MutableRawContact</span><span class="p">(</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">addresses</span><span class="p">:</span><span class="w"> </span><span class="n">MutableList</span><span class="o">&lt;</span><span class="n">MutableAddress</span><span class="o">&gt;</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RawContactEntity</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Address</span><span class="p">(</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">formattedAddress</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="p">)</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MutableAddress</span><span class="p">(</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">formattedAddress</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="p">)</span>
</span></code></pre></div>
<blockquote>
<p>ℹ️ The use of <code>sealed class</code> is to prevent consumers from defining their own entities. This
restriction may or may not change in the future.</p>
</blockquote>
<p>Notice that there is nothing mutable in the immutable <code>Contact</code>. Everything are <code>val</code>s and the data
structures used (i.e. <code>RawContact</code>, <code>Address</code>, and <code>List</code>) are all immutable. This provides
consumers 100% confidence that immutable entities are not mutable. They will not change or mutate
in any way. Once they are constructed, they will always remain the same.</p>
<p>Why immutability is so important will not be covered in this dev notes because it would be too big
(that's what she said) and there are blogs and books written about this. One of the most important
advantages of immutability is that it is thread-safe. Immutable instances can be used in several
different threads without the need for synchronization and worries about deadlocks. In other words,
they are thread-safe and faster than the mutable version.</p>
<p>The current structure also allows consumers to be able to distinguish between immutable and mutable
entities exhaustively. E.G.</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">doSomethingAndReturn</span><span class="p">(</span><span class="n">contact</span><span class="p">:</span><span class="w"> </span><span class="n">ContactEntity</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">MutableContact</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>ℹ️ The <strong>mutable entities provided in this library are NOT thread-safe</strong>. Consumers will have to 
perform their own synchronizations if they want to use and mutate mutable entities in
multi-threaded scenarios.</p>
</blockquote>
<h3 id="the-cost-of-the-current-immutability-implementation">The cost of the current immutability implementation<a class="headerlink" href="#the-cost-of-the-current-immutability-implementation" title="Permanent link">&para;</a></h3>
<p>The cost of implementing true immutability is more lines of code. Notice that the <code>MutableContact</code>
does not inherit from <code>Contact</code>. The same goes for the other entities. This leads to having to write
seemingly duplicate code when writing functions and extensions.</p>
<p>// FIXME? Furthermore, equality between immutable and mutable entities are not yet implemented. This
means that <code>Contact("john") == MutableContact("john")</code> will return false even though their
underlying contents are the same. This can be fixed by overriding the equals and hashcode functions
of all entities. However, that is a lot more code that I would like to avoid, which is why I'm
using <code>data class</code> for all entities in the first place! This may change in the future if the
community really wants to change it =)</p>
<p>On a side note, the same cost is incurred by Kotlin's standard libs. For example, notice that
<code>AbstractMutableList</code> does not inherit from and is completely separate from <code>AbstractList</code>. I'm sure
stdlib devs also had to write seemingly duplicate code in implementations of the <code>List</code> interface.</p>
<h3 id="avoiding-the-cost-shortcuts-and-pitfalls">Avoiding the cost... Shortcuts and pitfalls.<a class="headerlink" href="#avoiding-the-cost-shortcuts-and-pitfalls" title="Permanent link">&para;</a></h3>
<p>One thing that may come to mind in attempts to reduce lines of seemingly duplicate code is to have
just a mutable implementation of an immutable declaration. For example, we can restructure the
hierarchy to;</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Contact</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rawContacts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">RawContact</span><span class="o">&gt;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">}</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MutableContact</span><span class="p">(</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">rawContacts</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">MutableRawContact</span><span class="o">&gt;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Contact</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">RawContact</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">addresses</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="p">}</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MutableRawContact</span><span class="p">(</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">addresses</span><span class="p">:</span><span class="w"> </span><span class="n">MutableList</span><span class="o">&lt;</span><span class="n">MutableAddress</span><span class="o">&gt;</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RawContact</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="kd">sealed</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">formattedAddress</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="p">}</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MutableAddress</span><span class="p">(</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">formattedAddress</span><span class="p">:</span><span class="w"> </span><span class="kt">String?</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Address</span>
</span></code></pre></div>
<p>Notice that there is a non-concrete declaration (i.e. <code>Contact</code>, <code>RawContact</code>, and <code>Address</code>) and
just one concrete implementation (i.e. <code>MutableContact</code>, <code>MutableRawContact</code>, and <code>MutableAddress</code>).</p>
<blockquote>
<p>ℹ️ A <code>val</code> declaration can be overridden by a <code>var</code>. Keep in mind that <code>val</code> only requires getters
whereas <code>var</code> requires both getters and setters. Therefore, a <code>var</code> cannot be overridden by a 
<code>val</code>. Or maybe there is a different reason Kotlin imposes this restriction. On a similar note, 
the <code>List</code> interface can be overridden to a <code>MutableList</code>.</p>
</blockquote>
<p>We, as API contributors, can avoid having to write seemingly duplicate functions and extensions!</p>
<p>However! Can you see what's wrong with this setup? If we do this, we would either be deceiving
consumers to think that the instances of "immutable" class signatures (i.e. <code>Contact</code>, <code>RawContact</code>,
and <code>Address</code>) are actually immutable OR we would have to let consumers know that the API does not
really provide true immutability. Neither option is ideal (nor is it acceptable IMO).</p>
<p>Consumers would have a reference to a <code>Contact</code>, which they may assume is immutable because of the
usage of <code>val</code> instead of <code>var</code>, but in actuality the underlying implementation is mutable... This
could be a cause of really hard to find bugs in multi-threaded usage. Consumers may use <code>Contact</code>
with the assumption that it is immutable only to find that it can actually be mutated! We could
fix this by just making the mutable implementation thread-safe but since that is the only
implementation, consumers will be forced to use thread-safe code when they don't have to thereby
negatively affecting performance.</p>
<p>Keep in mind that thread safety is only one of several reasons for immutability. Those other
reasons will be violated too.</p>
<p>Consumers will be shocked if they ever do the following or something similar.</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">x</span><span class="p">(</span><span class="n">contact</span><span class="p">:</span><span class="w"> </span><span class="n">Contact</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">when</span><span class="p">(</span><span class="n">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">MutableContact</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// this is always true</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="k">is</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// this is always true</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>In any case, I have to admit, it is a nice trick that would save API contributors time. But that's
just it! It's just a trick. A shortcut. A nice little time save at the cost of integrity. It is not
worth it (IMO).</p>
<h2 id="why-not-add-android-x-support-library-dependencies">Why Not Add Android X / Support Library Dependencies?<a class="headerlink" href="#why-not-add-android-x-support-library-dependencies" title="Permanent link">&para;</a></h2>
<p>I want to keep the dependency list of this library to a minimum. The Contacts Provider is AOSP to
Android since the beginning. I want to honor that fact by avoiding adding dependencies here. I made
a bit of an exception by adding a permissions handling library for the permissions modules (not in 
the core modules). I'm tempted to remove the permissions dependency and implement permissions 
handling myself because external dependencies brings in other dependencies with it. However, it is 
not part of the core module so I'm able to live with this.</p>
<p>Keeping dependencies to a minimum is just a small challenge I made up. We will see how long it can
last!</p>
<p>I left comments all over the code on when an androidx dependency may be useful. The most glaring
example of this is @WorkerThread. Even with that, I'll hold off on adding the androidx annotation
lib. I think we can all be consenting adults =)</p>
<p>If the community strongly desires the addition of these support libs, then the community will win =)</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>